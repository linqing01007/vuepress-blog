<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前言 | 林晴的博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="林晴的个人博客">
    <meta name="author" content="林晴">
    
    <link rel="preload" href="/vuepress-blog/assets/css/0.styles.a53365af.css" as="style"><link rel="preload" href="/vuepress-blog/assets/js/app.de1052c8.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/2.b6e7c728.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/34.bb466845.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/js/10.4d993587.js"><link rel="prefetch" href="/vuepress-blog/assets/js/11.3de92a36.js"><link rel="prefetch" href="/vuepress-blog/assets/js/12.33c6a707.js"><link rel="prefetch" href="/vuepress-blog/assets/js/13.e9635f11.js"><link rel="prefetch" href="/vuepress-blog/assets/js/14.5004bcea.js"><link rel="prefetch" href="/vuepress-blog/assets/js/15.9d19c796.js"><link rel="prefetch" href="/vuepress-blog/assets/js/16.07462734.js"><link rel="prefetch" href="/vuepress-blog/assets/js/17.05758c46.js"><link rel="prefetch" href="/vuepress-blog/assets/js/18.4bd7405d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/19.0bf5472d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/20.67738b8b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/21.f11605a0.js"><link rel="prefetch" href="/vuepress-blog/assets/js/22.481d5f80.js"><link rel="prefetch" href="/vuepress-blog/assets/js/23.9982313b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/24.1ad2e968.js"><link rel="prefetch" href="/vuepress-blog/assets/js/25.2e0d7ea4.js"><link rel="prefetch" href="/vuepress-blog/assets/js/26.1ad50f6b.js"><link rel="prefetch" href="/vuepress-blog/assets/js/27.ba40573a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/28.d4e58e21.js"><link rel="prefetch" href="/vuepress-blog/assets/js/29.16a7e93e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/3.1357c17c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/30.fdc40ded.js"><link rel="prefetch" href="/vuepress-blog/assets/js/31.1ebbbac2.js"><link rel="prefetch" href="/vuepress-blog/assets/js/32.682d64b4.js"><link rel="prefetch" href="/vuepress-blog/assets/js/33.cc500df2.js"><link rel="prefetch" href="/vuepress-blog/assets/js/35.e45b5c38.js"><link rel="prefetch" href="/vuepress-blog/assets/js/36.434c442c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/37.94790aea.js"><link rel="prefetch" href="/vuepress-blog/assets/js/38.118cd991.js"><link rel="prefetch" href="/vuepress-blog/assets/js/39.af93e315.js"><link rel="prefetch" href="/vuepress-blog/assets/js/4.dec834b8.js"><link rel="prefetch" href="/vuepress-blog/assets/js/40.54f18c34.js"><link rel="prefetch" href="/vuepress-blog/assets/js/41.e34cacb3.js"><link rel="prefetch" href="/vuepress-blog/assets/js/42.f8822c70.js"><link rel="prefetch" href="/vuepress-blog/assets/js/43.5af1e7c0.js"><link rel="prefetch" href="/vuepress-blog/assets/js/44.57329301.js"><link rel="prefetch" href="/vuepress-blog/assets/js/45.71350c95.js"><link rel="prefetch" href="/vuepress-blog/assets/js/46.5b3dfc2f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/47.806135d3.js"><link rel="prefetch" href="/vuepress-blog/assets/js/48.01f8376e.js"><link rel="prefetch" href="/vuepress-blog/assets/js/49.30278d9c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/5.6f94c648.js"><link rel="prefetch" href="/vuepress-blog/assets/js/50.588062e7.js"><link rel="prefetch" href="/vuepress-blog/assets/js/51.1fcc6dd2.js"><link rel="prefetch" href="/vuepress-blog/assets/js/52.ebe7a612.js"><link rel="prefetch" href="/vuepress-blog/assets/js/53.338c2baf.js"><link rel="prefetch" href="/vuepress-blog/assets/js/54.637984b1.js"><link rel="prefetch" href="/vuepress-blog/assets/js/55.b94dbbe0.js"><link rel="prefetch" href="/vuepress-blog/assets/js/56.05880194.js"><link rel="prefetch" href="/vuepress-blog/assets/js/57.ff53340c.js"><link rel="prefetch" href="/vuepress-blog/assets/js/58.bd4f6e1a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/6.600bc016.js"><link rel="prefetch" href="/vuepress-blog/assets/js/7.d84fc58f.js"><link rel="prefetch" href="/vuepress-blog/assets/js/8.90f7891a.js"><link rel="prefetch" href="/vuepress-blog/assets/js/9.b29a76b1.js">
    <link rel="stylesheet" href="/vuepress-blog/assets/css/0.styles.a53365af.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-blog/" class="home-link router-link-active"><!----> <span class="site-name">林晴的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue3</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javascript专题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>dom</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>测试工程师</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>综合实践</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>diff确认平台-nodejs</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-blog/综合实践/diff确认平台-nodejs/diff确认页面.html" class="active sidebar-link">diff确认页面</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-blog/综合实践/diff确认平台-nodejs/diff确认页面.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/综合实践/diff确认平台-nodejs/diff确认页面.html#diff-vue" class="sidebar-link">Diff.vue</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/综合实践/diff确认平台-nodejs/diff确认页面.html#codecontent-vue" class="sidebar-link">CodeContent.vue</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/综合实践/diff确认平台-nodejs/diff确认页面.html#diffline-vue" class="sidebar-link">DiffLine.vue</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/综合实践/diff确认平台-nodejs/diff确认页面.html#parselinemodels-ts-实现" class="sidebar-link">parseLineModels.ts 实现</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/综合实践/diff确认平台-nodejs/diff确认页面.html#axios简单封装" class="sidebar-link">axios简单封装</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/综合实践/diff确认平台-nodejs/diff确认页面.html#其他内容" class="sidebar-link">其他内容</a></li><li class="sidebar-sub-header"><a href="/vuepress-blog/综合实践/diff确认平台-nodejs/diff确认页面.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/vuepress-blog/综合实践/diff确认平台-nodejs/koa-diff服务器搭建.html" class="sidebar-link">koa-diff服务器搭建</a></li><li><a href="/vuepress-blog/综合实践/diff确认平台-nodejs/svnhooks.html" class="sidebar-link">svnhooks</a></li><li><a href="/vuepress-blog/综合实践/diff确认平台-nodejs/简介.html" class="sidebar-link">简介</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>diff确认平台-python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>utils</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>大前端2021</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>小米商城</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>部署</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>diff确认页面使用vite+vue3+ts+elementui@3.x  搭建</p> <h2 id="diff-vue"><a href="#diff-vue" class="header-anchor">#</a> Diff.vue</h2> <h4 id="html模板"><a href="#html模板" class="header-anchor">#</a> html模板</h4> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>diff-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form</span> <span class="token attr-name">:inline</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">label-position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>left<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>large<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>searchForm<span class="token punctuation">&quot;</span></span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token style language-css"><span class="token property">text-align</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>提交者<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-select</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>searchForm.submitter<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-option</span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>无<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-option</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-option</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(item, key) in authors<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>key<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-option</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-select</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>分支<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-select</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>searchForm.branch<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-option</span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>无<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-option</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-option</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in branches<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-option</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-select</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>确认状态<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-select</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>searchForm.confirm<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-option</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(item, key) in confirmStates<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>key<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>key<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-option</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-select</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>提交日志<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>请输入提交日志<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>searchForm.comment<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleSearch<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>时间范围<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-date-picker</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>searchForm.startTime<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>datetime<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pick a start day<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-date-picker</span><span class="token punctuation">&gt;</span></span>
                    —
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-date-picker</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>searchForm.endTime<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>datetime<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pick a end day<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-date-picker</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>文件路径<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>请输入文件路径<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>searchForm.files<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleSearch<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleSearch<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>查询<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-radio-group</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-radio</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>json<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>json,cs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-radio</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-radio</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>all<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-radio</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-radio-group</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table</span> <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>diffData<span class="token punctuation">&quot;</span></span> <span class="token attr-name">border</span> <span class="token attr-name">stripe</span> <span class="token attr-name">:header-cell-style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cellStyle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:cell-style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cellStyle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">max-height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>900</span> <span class="token attr-name">@cell-click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleCellClick<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>version<span class="token punctuation">&quot;</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>版本<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>100</span> <span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>branch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>分支<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>230</span> <span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submitter<span class="token punctuation">&quot;</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>提交者<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>100</span> <span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>time<span class="token punctuation">&quot;</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>时间<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>240</span> <span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>提交日志<span class="token punctuation">&quot;</span></span> <span class="token attr-name">show-overflow-tooltip</span> <span class="token attr-name">min-width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>210</span> <span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scope<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-popover</span> <span class="token attr-name">effect</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>light<span class="token punctuation">&quot;</span></span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hover<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placement</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>top<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>860px<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#default</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>popover<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ scope.row.fileDiff.map((item: ResponseFileDiff) =&gt; item.name).join('\n')}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#reference</span><span class="token punctuation">&gt;</span></span>
                                {{ scope.row.comment }}
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-popover</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>confirmer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>确认<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>120</span> <span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>操作<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>200</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scope<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>default<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>showOneComment(scope.$index)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>查看<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>default<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>showFileList(scope.$index)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>列表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>default<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleConfirm(scope.$index)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>确认<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>default<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleCancel(scope.$index)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>取消<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-pagination</span> <span class="token attr-name">background</span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>prev, pager, next<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:page-count</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>totalPage<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">v-model:</span>current-page</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currentPage<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-pagination</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dialog</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialogVisible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1440px<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialogTitle<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialogContent==<span class="token punctuation">'</span>alldiff<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in oneCommitDiff<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>diff-line</span> <span class="token attr-name">:changeItem</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.changeItems<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:filename</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.name<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>diff-line</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!-- &lt;div v-html=&quot;lineHtml&quot;&gt;&lt;/div&gt; --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialogContent==<span class="token punctuation">'</span>filelist<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table</span> <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileList.value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">border</span> <span class="token attr-name">stripe</span> <span class="token attr-name">:header-cell-style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cellStyle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:cell-style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cellStyle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">max-height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>800</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>文件名<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>950</span> <span class="token punctuation">/&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>confirmer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>确认<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>200</span> <span class="token punctuation">/&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-table-column</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>操作<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>250</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scope<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>default<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>showFileDiff(scope.$index)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>查看<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>default<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleFileConfirm(scope.$index)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>确认<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>default<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleFileCancel(scope.$index)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>取消<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table-column</span><span class="token punctuation">&gt;</span></span>    
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-table</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dialog</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dialog</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileDiffVisible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1440px<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileList.comment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!-- &lt;pre v-html=&quot;fileDiff&quot;&gt;&lt;/pre&gt; --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>diff-line</span> <span class="token attr-name">:changeItem</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileList.currentItem<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:filename</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileList.currentName<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>diff-line</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dialog</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p><code>script, setup语法&lt;script setup&gt;&lt;/script&gt;</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> computed<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> toRaw<span class="token punctuation">,</span> watchEffect<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> nextTick<span class="token punctuation">,</span> <span class="token keyword">type</span> <span class="token class-name">Directive</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">BRANCHES</span><span class="token punctuation">,</span> <span class="token constant">CONFIRMSTATUS</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../config'</span>
<span class="token keyword">import</span> DiffLine <span class="token keyword">from</span> <span class="token string">'../components/DiffLine.vue'</span>
<span class="token keyword">import</span> instance <span class="token keyword">from</span> <span class="token string">'../api/index'</span>
<span class="token keyword">import</span> hljs <span class="token keyword">from</span> <span class="token string">'highlight.js'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ElMessage  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'element-plus'</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> ChangeItem<span class="token punctuation">,</span> CodeLineModel<span class="token punctuation">,</span> CollapseLineModel <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../components/parseCharModel'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> content <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../mock'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> parseCharChanges<span class="token punctuation">,</span> ChangeItem<span class="token punctuation">,</span> CodeLineModel<span class="token punctuation">,</span> CollapseLineModel <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../components/parseLineModels'</span>
<span class="token keyword">const</span> <span class="token constant">SUCCESS_CODE</span> <span class="token operator">=</span> <span class="token number">0</span>


<span class="token keyword">type</span> <span class="token class-name">ResponseFileDiff</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span>
    confirmer<span class="token operator">:</span> <span class="token builtin">string</span>
    content<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
  
<span class="token keyword">type</span> <span class="token class-name">DiffObject</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    branch<span class="token operator">:</span> <span class="token builtin">string</span>
    comment<span class="token operator">:</span> <span class="token builtin">string</span>
    confirmer<span class="token operator">:</span> <span class="token builtin">string</span>
    fileDiff<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>ResponseFileDiff<span class="token operator">&gt;</span>
    diff<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>ResponseFileDiff<span class="token operator">&gt;</span>
    files<span class="token operator">:</span> <span class="token builtin">string</span>
    time<span class="token operator">:</span> <span class="token builtin">string</span>
    version<span class="token operator">:</span> <span class="token builtin">string</span>
    submitter<span class="token operator">:</span> <span class="token builtin">string</span>
    _id<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">FileListObject</span> <span class="token punctuation">{</span>
    version<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token comment">// 该次提交diff的version</span>
    _index<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token comment">// allDiff中的index</span>
    comment<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token comment">// 提交日志</span>
    value<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>ResponseFileDiff<span class="token operator">&gt;</span> <span class="token comment">// 文件列表显示</span>
    currentItem<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token comment">// 在文件列表中查看的某个文件diff</span>
    currentName<span class="token operator">:</span> <span class="token builtin">string</span>  <span class="token comment">// 当前查看的文件名</span>
    <span class="token comment">// id: string</span>
    <span class="token comment">// diffIndex: number</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">IResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
    code<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    msg<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token constant">T</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">SearchForm</span> <span class="token punctuation">{</span>
    submitter<span class="token operator">:</span> <span class="token builtin">string</span>
    branch<span class="token operator">:</span> <span class="token builtin">string</span>
    confirm<span class="token operator">:</span> <span class="token builtin">string</span>
    startTime<span class="token operator">:</span> <span class="token builtin">string</span>
    endTime<span class="token operator">:</span> <span class="token builtin">string</span>
    comment<span class="token operator">:</span> <span class="token builtin">string</span>
    files<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">HTMLElementPlus</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>
    <span class="token comment">// 对HTMLElement 做一下扩展</span>
    <span class="token function-variable function">__documentHandler</span><span class="token operator">:</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> MouseEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">OneFileDiff</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span>
    changeItems<span class="token operator">:</span> <span class="token builtin">string</span>
    confirmer<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> vCloseOnClick<span class="token operator">:</span> Directive<span class="token operator">&lt;</span>HTMLElementPlus<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">mounted</span> <span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span><span class="token function-variable function">__documentHandler</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> MouseEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target <span class="token keyword">as</span> HTMLElement<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>binding<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                binding<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span>__documentHandler<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">unmounted</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span>__documentHandler<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

hljs<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    ignoreUnescapedHTML<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    languages<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lua&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;cs&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 表单字段</span>
<span class="token keyword">const</span> searchForm <span class="token operator">=</span> <span class="token generic-function"><span class="token function">reactive</span><span class="token generic class-name"><span class="token operator">&lt;</span>SearchForm<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    submitter<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    branch<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    confirm<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    comment<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    files<span class="token operator">:</span> <span class="token string">''</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 当前选中的diff内容</span>
<span class="token keyword">const</span> oneCommitDiff <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span>OneFileDiff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 当前查看的提交Index，用于确认单个文件后的更新</span>
<span class="token keyword">let</span> diffIndex <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">// 文件列表</span>
<span class="token keyword">const</span> fileList <span class="token operator">=</span> <span class="token generic-function"><span class="token function">reactive</span><span class="token generic class-name"><span class="token operator">&lt;</span>FileListObject<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    version<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    _index<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    comment<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    value<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    currentItem<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    currentName<span class="token operator">:</span> <span class="token string">''</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 单个文件的diff信息</span>
<span class="token keyword">const</span> oneFileDiff <span class="token operator">=</span> <span class="token generic-function"><span class="token function">reactive</span><span class="token generic class-name"><span class="token operator">&lt;</span>OneFileDiff<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    changeItems<span class="token operator">:</span> <span class="token string">''</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 弹窗是否显示以及弹窗内容：单次提交的diff信息或者文件列表</span>
<span class="token keyword">const</span> dialogVisible <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> dialogContent <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> dialogTitle <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>

<span class="token comment">// 是否显示单个文件diff</span>
<span class="token keyword">const</span> fileDiffVisible <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

<span class="token comment">// 当前表格页数</span>
<span class="token keyword">const</span> currentPage <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">// 每页显示的数据数量</span>
<span class="token keyword">const</span> pageSize <span class="token operator">=</span> <span class="token number">10</span>
<span class="token comment">// 所有的diff数据</span>
<span class="token keyword">let</span> allDiff <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">Array</span><span class="token operator">&lt;</span>DiffObject<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// 当前页的diff数据，每页10条</span>
<span class="token keyword">const</span> diffData <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> allDiff<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">(</span>currentPage<span class="token punctuation">.</span>value <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize<span class="token punctuation">,</span> currentPage<span class="token punctuation">.</span>value <span class="token operator">*</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 总页数</span>
<span class="token keyword">const</span> totalPage <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>allDiff<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length <span class="token operator">/</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 表格单元格的样式</span>
<span class="token keyword">const</span> cellStyle <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'text-align'</span><span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span>
    <span class="token string">'line-height'</span><span class="token operator">:</span> <span class="token string">'25px'</span>
<span class="token punctuation">}</span>
<span class="token comment">// 作者，分支名，确认状态</span>
<span class="token keyword">let</span> authors <span class="token operator">=</span> <span class="token generic-function"><span class="token function">reactive</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span>
    <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> branches <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token constant">BRANCHES</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> confirmStates <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token constant">CONFIRMSTATUS</span><span class="token punctuation">)</span>

<span class="token comment">// 文件类型筛选</span>
<span class="token keyword">const</span> fileType <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'json'</span><span class="token punctuation">)</span>
<span class="token function">watch</span><span class="token punctuation">(</span>fileType<span class="token punctuation">,</span> <span class="token punctuation">(</span>curVal<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>curVal <span class="token operator">==</span> <span class="token string">'json'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        allDiff<span class="token punctuation">.</span>value <span class="token operator">=</span> tmpJsonDiff
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        allDiff<span class="token punctuation">.</span>value <span class="token operator">=</span> tmpAllDiff
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">showDialog</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token keyword">type</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dialogContent<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">type</span>
    <span class="token class-name">dialogVisible</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>
    dialogTitle<span class="token punctuation">.</span>value <span class="token operator">=</span> title
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">showFileDiffDialog</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fileDiffVisible<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> tmpAllDiff<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>DiffObject<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> tmpJsonDiff<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>DiffObject<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> <span class="token function-variable function">filterDiffData</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>DiffObject<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tmpJsonDiff <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token function">formatSubmitter</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    tmpAllDiff <span class="token operator">=</span> data
    data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> newItem <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span>
        newItem<span class="token punctuation">.</span>submitter <span class="token operator">=</span> authors<span class="token punctuation">[</span>newItem<span class="token punctuation">.</span>submitter<span class="token punctuation">]</span> <span class="token operator">||</span> newItem<span class="token punctuation">.</span>submitter
        <span class="token keyword">let</span> newDiff <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> diffObj <span class="token keyword">of</span> newItem<span class="token punctuation">.</span>fileDiff<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// TODO: 放到一个常量里面去</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>diffObj<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.json'</span><span class="token punctuation">)</span> <span class="token operator">||</span> diffObj<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.cs'</span><span class="token punctuation">)</span> <span class="token operator">||</span> diffObj<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.lua'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                newDiff<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>diffObj<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        newItem<span class="token punctuation">.</span>fileDiff <span class="token operator">=</span> newDiff
        newItem<span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>time<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newDiff<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tmpJsonDiff<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newItem<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    allDiff<span class="token punctuation">.</span>value <span class="token operator">=</span> tmpJsonDiff
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">handleSearch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>searchForm<span class="token punctuation">.</span>startTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> startTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>searchForm<span class="token punctuation">.</span>startTime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>startTime <span class="token operator">&gt;</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">ElMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                message<span class="token operator">:</span> <span class="token string">'开始时间不能晚于当前时间！'</span><span class="token punctuation">,</span>
                <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'warning'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>searchForm<span class="token punctuation">.</span>endTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> endTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>searchForm<span class="token punctuation">.</span>endTime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>startTime <span class="token operator">&gt;</span> endTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">ElMessage</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
                    message<span class="token operator">:</span> <span class="token string">'开始时间不能晚于结束时间噢！'</span><span class="token punctuation">,</span>
                    <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'warning'</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>searchForm<span class="token punctuation">.</span>endTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">ElMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            message<span class="token operator">:</span> <span class="token string">'请选择开始时间'</span><span class="token punctuation">,</span>
            <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'warning'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> params<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">let</span> key<span class="token operator">:</span> <span class="token keyword">keyof</span> SearchForm
    <span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> <span class="token function">toRaw</span><span class="token punctuation">(</span>searchForm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>searchForm<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> searchForm<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'startTime'</span> <span class="token operator">||</span> key <span class="token operator">===</span> <span class="token string">'endTime'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> searchForm<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 对时间参数的处理，主要决定于后端需要什么格式</span>
            params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>searchForm<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    instance<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span>DiffObject<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> 
        params
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">!==</span> <span class="token constant">SUCCESS_CODE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> res<span class="token punctuation">.</span>data
        <span class="token function">filterDiffData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">formatSubmitter</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>DiffObject<span class="token operator">&gt;</span> <span class="token operator">|</span> DiffObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data <span class="token operator">=</span> <span class="token punctuation">[</span>data<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        item<span class="token punctuation">.</span>submitter <span class="token operator">=</span> authors<span class="token punctuation">[</span>item<span class="token punctuation">.</span>submitter<span class="token punctuation">]</span> <span class="token operator">||</span> item<span class="token punctuation">.</span>submitter
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">getSubmitters</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    instance<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token operator">&lt;</span><span class="token punctuation">{</span> <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">'/getSubmitters'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">!==</span> <span class="token constant">SUCCESS_CODE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> res<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            authors<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">showOneComment</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// 单个提交的diff</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> diffData<span class="token punctuation">.</span>value<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token keyword">let</span> comment <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> diffObj <span class="token keyword">of</span> data<span class="token punctuation">.</span>fileDiff<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        comment<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            name<span class="token operator">:</span> diffObj<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
            changeItems<span class="token operator">:</span> diffObj<span class="token punctuation">.</span>content
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    oneCommitDiff<span class="token punctuation">.</span>value <span class="token operator">=</span> comment
    <span class="token function">showDialog</span><span class="token punctuation">(</span><span class="token string">'alldiff'</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>comment<span class="token punctuation">)</span>
    <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;.outside&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>el <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            hljs<span class="token punctuation">.</span><span class="token function">highlightElement</span><span class="token punctuation">(</span>el <span class="token keyword">as</span> HTMLElement<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">showFileList</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 文件列表</span>
    diffIndex <span class="token operator">=</span> index
    <span class="token keyword">let</span> data <span class="token operator">=</span> diffData<span class="token punctuation">.</span>value<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    fileList<span class="token punctuation">.</span>value <span class="token operator">=</span> data<span class="token punctuation">.</span>fileDiff
    fileList<span class="token punctuation">[</span><span class="token string">'version'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>version
    fileList<span class="token punctuation">[</span><span class="token string">'_index'</span><span class="token punctuation">]</span> <span class="token operator">=</span> index
    fileList<span class="token punctuation">[</span><span class="token string">'comment'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>comment
    <span class="token function">showDialog</span><span class="token punctuation">(</span><span class="token string">'filelist'</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>comment<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">showFileDiff</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 文件diff</span>
    <span class="token keyword">let</span> fileObj <span class="token operator">=</span> fileList<span class="token punctuation">.</span>value<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    fileList<span class="token punctuation">.</span>currentItem <span class="token operator">=</span> fileObj<span class="token punctuation">.</span>content
    fileList<span class="token punctuation">.</span>currentName <span class="token operator">=</span> fileObj<span class="token punctuation">.</span>name
    fileDiffVisible<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token function">showFileDiffDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;.outside&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>el <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            hljs<span class="token punctuation">.</span><span class="token function">highlightElement</span><span class="token punctuation">(</span>el <span class="token keyword">as</span> HTMLElement<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> 

<span class="token keyword">const</span> <span class="token function-variable function">handleConfirm</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 点击确认</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> diffData<span class="token punctuation">.</span>value<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token keyword">let</span> version <span class="token operator">=</span> data<span class="token punctuation">.</span>version
    instance<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span>DiffObject<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'/confirmCommit'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        version
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">!=</span> <span class="token constant">SUCCESS_CODE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> res<span class="token punctuation">.</span>data
        <span class="token function">formatSubmitter</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        data<span class="token punctuation">.</span>submitter <span class="token operator">=</span> authors<span class="token punctuation">[</span>data<span class="token punctuation">.</span>submitter<span class="token punctuation">]</span> <span class="token operator">||</span> data<span class="token punctuation">.</span>submitter
        allDiff<span class="token punctuation">.</span>value<span class="token punctuation">[</span>index <span class="token operator">+</span> <span class="token punctuation">(</span>currentPage<span class="token punctuation">.</span>value <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize<span class="token punctuation">]</span> <span class="token operator">=</span> data
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">handleCancel</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 取消确认</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> diffData<span class="token punctuation">.</span>value<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token keyword">let</span> version <span class="token operator">=</span> data<span class="token punctuation">.</span>version
    instance<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span>DiffObject<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'/cancelConfirmCommit'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        version
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">!=</span> <span class="token constant">SUCCESS_CODE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> res<span class="token punctuation">.</span>data
        <span class="token function">formatSubmitter</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        data<span class="token punctuation">.</span>submitter <span class="token operator">=</span> authors<span class="token punctuation">[</span>data<span class="token punctuation">.</span>submitter<span class="token punctuation">]</span> <span class="token operator">||</span> data<span class="token punctuation">.</span>submitter
        allDiff<span class="token punctuation">.</span>value<span class="token punctuation">[</span>index <span class="token operator">+</span> <span class="token punctuation">(</span>currentPage<span class="token punctuation">.</span>value <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize<span class="token punctuation">]</span> <span class="token operator">=</span> data
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">handleFileConfirm</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 确认单个文件</span>
    <span class="token keyword">let</span> fileData <span class="token operator">=</span> fileList<span class="token punctuation">.</span>value<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token keyword">let</span> version <span class="token operator">=</span> fileList<span class="token punctuation">.</span>version
    <span class="token keyword">let</span> fileName <span class="token operator">=</span> fileData<span class="token punctuation">.</span>name
    <span class="token keyword">let</span> diffIndex <span class="token operator">=</span> fileList<span class="token punctuation">.</span>_index
    instance<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span>DiffObject<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'/confirmFile'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        version<span class="token punctuation">,</span>
        fileName
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">!=</span> <span class="token constant">SUCCESS_CODE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> res<span class="token punctuation">.</span>data
        <span class="token function">formatSubmitter</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        allDiff<span class="token punctuation">.</span>value<span class="token punctuation">[</span>diffIndex <span class="token operator">+</span> <span class="token punctuation">(</span>currentPage<span class="token punctuation">.</span>value <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize<span class="token punctuation">]</span> <span class="token operator">=</span> data
        fileList<span class="token punctuation">.</span>value<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>confirmer <span class="token operator">=</span> authors<span class="token punctuation">[</span>data<span class="token punctuation">.</span>fileDiff<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>confirmer<span class="token punctuation">]</span> <span class="token operator">||</span> data<span class="token punctuation">.</span>fileDiff<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>confirmer
        fileList<span class="token punctuation">.</span>value<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>confirmer <span class="token operator">=</span> data<span class="token punctuation">.</span>fileDiff<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>confirmer
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">handleFileCancel</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 取消文件的确认</span>
    <span class="token keyword">let</span> fileData <span class="token operator">=</span> fileList<span class="token punctuation">.</span>value<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token keyword">let</span> version <span class="token operator">=</span> fileList<span class="token punctuation">.</span>version
    <span class="token keyword">let</span> fileName <span class="token operator">=</span> fileData<span class="token punctuation">.</span>name
    <span class="token keyword">let</span> diffIndex <span class="token operator">=</span> fileList<span class="token punctuation">.</span>_index
    instance<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span>DiffObject<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'/cancelConfirmFile'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        version<span class="token punctuation">,</span>
        fileName
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">!=</span> <span class="token constant">SUCCESS_CODE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> res<span class="token punctuation">.</span>data
        <span class="token function">formatSubmitter</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
            allDiff<span class="token punctuation">.</span>value<span class="token punctuation">[</span>diffIndex <span class="token operator">+</span> <span class="token punctuation">(</span>currentPage<span class="token punctuation">.</span>value <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize<span class="token punctuation">]</span> <span class="token operator">=</span> data
        fileList<span class="token punctuation">.</span>value<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>confirmer <span class="token operator">=</span> authors<span class="token punctuation">[</span>data<span class="token punctuation">.</span>fileDiff<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>confirmer<span class="token punctuation">]</span> <span class="token operator">||</span> data<span class="token punctuation">.</span>fileDiff<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>confirmer
        fileList<span class="token punctuation">.</span>value<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>confirmer <span class="token operator">=</span> data<span class="token punctuation">.</span>fileDiff<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>confirmer
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">handleCellClick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>row<span class="token operator">:</span> DiffObject<span class="token punctuation">,</span> column<span class="token operator">:</span> <span class="token punctuation">{</span> label<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>column<span class="token punctuation">.</span>label <span class="token operator">!==</span> <span class="token string">'提交日志'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    oneCommitDiff<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> diffObj <span class="token keyword">of</span> row<span class="token punctuation">.</span>fileDiff<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        oneCommitDiff<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            changeItems<span class="token operator">:</span> diffObj<span class="token punctuation">.</span>content<span class="token punctuation">,</span>
            name<span class="token operator">:</span> diffObj<span class="token punctuation">.</span>name
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">showDialog</span><span class="token punctuation">(</span><span class="token string">'alldiff'</span><span class="token punctuation">,</span> row<span class="token punctuation">.</span>comment<span class="token punctuation">)</span>
    <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;.outside&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>el <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            hljs<span class="token punctuation">.</span><span class="token function">highlightElement</span><span class="token punctuation">(</span>el <span class="token keyword">as</span> HTMLElement<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">getFileDiff</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    instance<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token operator">&lt;</span>DiffObject<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">'/getDiff'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">filterDiffData</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">getDiffData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">getSubmitters</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">getFileDiff</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="codecontent-vue"><a href="#codecontent-vue" class="header-anchor">#</a> CodeContent.vue</h2> <p>这里采用jsx写法会更便捷,需在script中指定lang='tsx',需要安装<code>&quot;@vitejs/plugin-vue-jsx&quot;: &quot;^2.1.1&quot;</code>插件来支持
在vite.config.ts中添加配置</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> vueJsx <span class="token keyword">from</span> <span class="token string">'@vitejs/plugin-vue-jsx'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">vueJsx</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>&lt;script lang='tsx'&gt;&lt;/script&gt;</code></p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> type <span class="token punctuation">{</span> CodeLineModel<span class="token punctuation">,</span> CollapseLineModel<span class="token punctuation">,</span> FileType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./parseCharModel'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span>
<span class="token keyword">import</span> type <span class="token punctuation">{</span> PropType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;CodeContent&quot;</span><span class="token punctuation">,</span>
    props<span class="token operator">:</span> <span class="token punctuation">{</span>
        code<span class="token operator">:</span> <span class="token punctuation">{</span>
            required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            type<span class="token operator">:</span> Object <span class="token keyword">as</span> PropType<span class="token operator">&lt;</span>CodeLineModel <span class="token operator">|</span> CollapseLineModel<span class="token operator">&gt;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        fileType<span class="token operator">:</span> <span class="token punctuation">{</span>
            type<span class="token operator">:</span> String <span class="token keyword">as</span> PropType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FileType</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">,
            default: 'json'
        }
    },
    render () </span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>code<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'add'</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>code<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'delete'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">segmentCodeByIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> res
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>code<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'collapsed'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCollapsedTemplate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>code<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCodeTemplate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>code<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token plain-text">,
    methods: </span><span class="token punctuation">{</span>
        <span class="token function">getClassName</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> classMap <span class="token operator">=</span> <span class="token punctuation">{</span>
                json<span class="token operator">:</span> <span class="token string">'language-json'</span><span class="token punctuation">,</span>
                cs<span class="token operator">:</span> <span class="token string">'language-csharp'</span><span class="token punctuation">,</span>
                lua<span class="token operator">:</span> <span class="token string">'language-lua'</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">let</span> res <span class="token operator">=</span> classMap<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>fileType<span class="token punctuation">]</span>
            <span class="token keyword">return</span> classMap<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>fileType<span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">getCodeTemplate</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">&lt;</span>pre <span class="token keyword">class</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' outside'</span> <span class="token punctuation">}</span> innerHTML<span class="token operator">=</span><span class="token punctuation">{</span> content <span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">getInlineTemplate</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token operator">:</span> string<span class="token punctuation">,</span> className<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">&lt;</span>span <span class="token keyword">class</span> <span class="token operator">=</span> <span class="token punctuation">{</span> className <span class="token operator">??</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">}</span> innerHTML<span class="token operator">=</span><span class="token punctuation">{</span> content <span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">segmentCodeByIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 变更行的HTML</span>
            <span class="token keyword">let</span> className <span class="token operator">=</span> <span class="token string">''</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>code<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'add'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                className <span class="token operator">=</span> <span class="token string">'add-inline'</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>code<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'delete'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                className <span class="token operator">=</span> <span class="token string">'delete-inline'</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">const</span> codeLineModel <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token keyword">as</span> CodeLineModel
            <span class="token keyword">const</span> content <span class="token operator">=</span> codeLineModel<span class="token punctuation">.</span>content

            <span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>codeLineModel<span class="token punctuation">.</span>highlightStartIndex <span class="token operator">||</span> codeLineModel<span class="token punctuation">.</span>highlightStartIndex<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCodeTemplate</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">let</span> lastStartIndex <span class="token operator">=</span> <span class="token number">0</span>
            codeLineModel<span class="token punctuation">.</span>highlightStartIndex<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">startIndex<span class="token operator">:</span> number<span class="token punctuation">,</span> index<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> length <span class="token operator">=</span> <span class="token punctuation">(</span>codeLineModel<span class="token punctuation">.</span>hightLightLength <span class="token keyword">as</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span>
                items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>lastStartIndex<span class="token punctuation">,</span> startIndex<span class="token punctuation">)</span><span class="token punctuation">)</span>
                items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getInlineTemplate</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>startIndex<span class="token punctuation">,</span> startIndex <span class="token operator">+</span> length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> className<span class="token punctuation">)</span><span class="token punctuation">)</span>
                lastStartIndex <span class="token operator">=</span> startIndex <span class="token operator">+</span> length
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>lastStartIndex<span class="token punctuation">,</span> content<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token operator">&lt;</span>pre <span class="token keyword">class</span> <span class="token operator">=</span> <span class="token string">&quot;outside-line&quot;</span><span class="token operator">&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span> <span class="token attr-name">innerHTML</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span> content <span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">getCollapsedTemplate</span><span class="token punctuation">(</span><span class="token parameter">lineData<span class="token operator">:</span> CollapseLineModel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lineData<span class="token punctuation">.</span>lines <span class="token operator">||</span> lineData<span class="token punctuation">.</span>lines<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">let</span> content <span class="token operator">=</span> lineData<span class="token punctuation">.</span>lines<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content
            content <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@@ </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>content<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
            <span class="token keyword">return</span> <span class="token operator">&lt;</span>pre className <span class="token operator">=</span> <span class="token string">'collapsed'</span> <span class="token keyword">class</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span> content <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token plain-text">
})
</span></code></pre></div><h2 id="diffline-vue"><a href="#diffline-vue" class="header-anchor">#</a> DiffLine.vue</h2> <p>对输入的数据进行处理，输出每一行的HTML</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-card</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>diff-line<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#header</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>card-header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{ filename }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(code, index,) in lineModles<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code.type !== <span class="token punctuation">'</span>collapsed<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>line<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{ add: code.type === <span class="token punctuation">'</span>add<span class="token punctuation">'</span>, delete: code.type === <span class="token punctuation">'</span>delete<span class="token punctuation">'</span>}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>line-number<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        {{ code.oldLineNumber }}
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>line-number<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        {{ code.newLineNumber }}
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code-content</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>line-content<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{ add: code.type === <span class="token punctuation">'</span>add<span class="token punctuation">'</span>, delete: code.type === <span class="token punctuation">'</span>delete<span class="token punctuation">'</span>}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:code</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> code</span> <span class="token attr-name">:fileType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code-content</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-else</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>collapsed-line<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>icon-row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">t</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1665045334100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onUpClick(index)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>icon icon-up<span class="token punctuation">&quot;</span></span> <span class="token attr-name">viewBox</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0 0 1024 1024<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2000/svg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">p-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2444<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>200<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>200<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>M966.4 668.8l-435.2-432c-9.6-9.6-25.6-9.6-35.2 0l-441.6 432c-9.6 9.6-9.6 25.6 0 35.2 9.6 9.6 25.6 9.6 35.2 0l425.6-416 416 416c9.6 9.6 25.6 9.6 35.2 0S976 678.4 966.4 668.8z<span class="token punctuation">&quot;</span></span> <span class="token attr-name">p-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2445<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>path</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">t</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1665045394276<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onDownClick(index)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>icon icon-down<span class="token punctuation">&quot;</span></span> <span class="token attr-name">viewBox</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0 0 1024 1024<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2000/svg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">p-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3346<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>200<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>200<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span> <span class="token attr-name">d</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>M520.4992 797.696l467.456-459.776c7.2704-7.168 7.3728-18.8416 0.2048-26.0096-7.168-7.2704-18.8416-7.3728-26.0096-0.2048L507.6992 758.6816 54.8864 305.8688c-7.168-7.168-18.8416-7.168-26.0096 0-3.584 3.584-5.4272 8.2944-5.4272 13.0048 0 4.7104 1.8432 9.4208 5.4272 13.0048L494.592 797.5936C501.6576 804.7616 513.2288 804.7616 520.4992 797.696z<span class="token punctuation">&quot;</span></span> <span class="token attr-name">p-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3347<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>path</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code-content</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>line-content<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>code</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code-content</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-card</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>script setup lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> computed<span class="token punctuation">,</span> nextTick<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> onUpdated<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> PropType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> CodeContent <span class="token keyword">from</span> <span class="token string">'./CodeContent.vue'</span>
<span class="token comment">// 使用hljs库进行高亮</span>
<span class="token keyword">import</span> hljs <span class="token keyword">from</span> <span class="token string">'highlight.js'</span>
<span class="token keyword">import</span> <span class="token string">'highlight.js/styles/github.css'</span>

<span class="token comment">// import { type CollapseLineModel, type FileType, type ChangeItem, parseCharChanges } from './parseCharModel'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">type</span> <span class="token class-name">CollapseLineModel</span><span class="token punctuation">,</span> <span class="token keyword">type</span> <span class="token class-name">FileType</span><span class="token punctuation">,</span> <span class="token keyword">type</span> <span class="token class-name">ChangeItem</span><span class="token punctuation">,</span> parseCharChanges <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./parseLineModels'</span>
<span class="token keyword">import</span> <span class="token string">'./parseLineModels'</span>
<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    changeItem<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token keyword">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
        required<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token keyword">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> lineModles <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token function">parseCharChanges</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>changeItem<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fileType <span class="token operator">=</span> <span class="token generic-function"><span class="token function">computed</span><span class="token generic class-name"><span class="token operator">&lt;</span>FileType<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> FileType <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tmp <span class="token operator">=</span> props<span class="token punctuation">.</span>filename<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> tmp<span class="token punctuation">[</span>tmp<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">as</span> FileType
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">onUpClick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> lineModle <span class="token operator">=</span> lineModles<span class="token punctuation">.</span>value<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token keyword">const</span> delLine <span class="token operator">=</span> <span class="token punctuation">(</span>lineModle <span class="token keyword">as</span> CollapseLineModel<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'lines'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>lineModle <span class="token keyword">as</span> CollapseLineModel<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'lines'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lineModles<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">(</span>delLine <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            lineModles<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">(</span>delLine <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>lineModle <span class="token keyword">as</span> CollapseLineModel<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'lines'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lineModles<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">(</span>delLine <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            lineModles<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">(</span>delLine <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.outside'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>el <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            hljs<span class="token punctuation">.</span><span class="token function">highlightElement</span><span class="token punctuation">(</span>el <span class="token keyword">as</span> HTMLElement<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">onDownClick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> lineModle <span class="token operator">=</span> lineModles<span class="token punctuation">.</span>value<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token keyword">const</span> length <span class="token operator">=</span> <span class="token punctuation">(</span>lineModle <span class="token keyword">as</span> CollapseLineModel<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'lines'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length
    <span class="token keyword">const</span> delLine <span class="token operator">=</span> <span class="token punctuation">(</span>lineModle <span class="token keyword">as</span> CollapseLineModel<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'lines'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>length <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span> 
    <span class="token comment">// lineModles.splice(index, 0, ...(delLine as any))</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> lineModles<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>lineModle <span class="token keyword">as</span> CollapseLineModel<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'lines'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lineModles<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">(</span>delLine <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            lineModles<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">(</span>delLine <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>lineModle <span class="token keyword">as</span> CollapseLineModel<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'lines'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lineModles<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">(</span>delLine <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            lineModles<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">(</span>delLine <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.outside'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>el <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            hljs<span class="token punctuation">.</span><span class="token function">highlightElement</span><span class="token punctuation">(</span>el <span class="token keyword">as</span> HTMLElement<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">onUpdated</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    lineModles<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">parseCharChanges</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>changeItem<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h2 id="parselinemodels-ts-实现"><a href="#parselinemodels-ts-实现" class="header-anchor">#</a> parseLineModels.ts 实现</h2> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 根据服务器返回的diff文本进行解析</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> content <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../mock'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> diffChars<span class="token punctuation">,</span> diffWords<span class="token punctuation">,</span> diffWordsWithSpace <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'diff'</span>

<span class="token keyword">const</span> contextLineCount <span class="token operator">=</span> <span class="token number">5</span>

<span class="token keyword">type</span> <span class="token class-name">DiffType</span> <span class="token operator">=</span> <span class="token string">'add'</span> <span class="token operator">|</span> <span class="token string">'delete'</span> <span class="token operator">|</span> <span class="token string">'normal'</span>

<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">FileType</span> <span class="token operator">=</span> <span class="token string">'json'</span> <span class="token operator">|</span> <span class="token string">'cs'</span> <span class="token operator">|</span> <span class="token string">'lua'</span>
<span class="token keyword">interface</span> <span class="token class-name">LineMapping</span> <span class="token punctuation">{</span>
    old<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token keyword">type</span> <span class="token class-name"><span class="token keyword">in</span></span> DiffType<span class="token punctuation">]</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
    <span class="token punctuation">}</span>
    now<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token keyword">type</span> <span class="token class-name"><span class="token keyword">in</span></span> DiffType<span class="token punctuation">]</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">ILineModel</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span><span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">CodeLineModel</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span><span class="token operator">:</span> DiffType
    oldLineNumber<span class="token operator">:</span> <span class="token builtin">string</span>
    newLineNumber<span class="token operator">:</span> <span class="token builtin">string</span>
    content<span class="token operator">:</span> <span class="token builtin">string</span>
    highlightStartIndex<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    hightLightLength<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">CollapseLineModel</span> <span class="token keyword">extends</span> <span class="token class-name">ILineModel</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'collapsed'</span>
    lines<span class="token operator">:</span> CodeLineModel<span class="token punctuation">[</span><span class="token punctuation">]</span>
    isCollapsed<span class="token operator">:</span> <span class="token builtin">boolean</span>
    lineCount<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ChangeItem</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    count<span class="token operator">:</span> <span class="token builtin">number</span>
    value<span class="token operator">:</span> <span class="token builtin">string</span>
    removed<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
    added<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>

<span class="token punctuation">}</span>

<span class="token keyword">let</span> lineMapping<span class="token operator">:</span> LineMapping<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> lineModels<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>CodeLineModel<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> currentNowNumber <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">let</span> currentOldNumber <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">let</span> lastIsDelete <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lineMapping <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    lineModels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    lineModels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    currentNowNumber <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    currentOldNumber <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token punctuation">}</span>

<span class="token comment">// python 版本</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">parseCharChanges</span><span class="token punctuation">(</span>diffChanges<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>CodeLineModel <span class="token operator">|</span> CollapseLineModel<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> lines <span class="token operator">=</span> <span class="token function">parseLine</span><span class="token punctuation">(</span>diffChanges<span class="token punctuation">)</span>
    <span class="token function">parseLineModel</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span>
    <span class="token comment">// console.log(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; linemodels:&quot;, lineModels)</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">processCollapsed</span><span class="token punctuation">(</span>lineModels<span class="token punctuation">)</span>
    <span class="token comment">// console.log('&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;result: ', result)</span>
    <span class="token keyword">return</span> result
<span class="token punctuation">}</span>

<span class="token comment">// nodejs版本</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">parseCharChanges</span><span class="token punctuation">(</span>diffChanges<span class="token operator">:</span> ChangeItem<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>CodeLineModel <span class="token operator">|</span> CollapseLineModel<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    diffChanges<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>change<span class="token punctuation">,</span> index<span class="token punctuation">,</span> diffChanges<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">processNext</span><span class="token punctuation">(</span>change<span class="token punctuation">,</span> index<span class="token punctuation">,</span> diffChanges<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">processCollapsed</span><span class="token punctuation">(</span>lineModels<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> result
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getMarkIndexs</span><span class="token punctuation">(</span>line<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 返回行中 ^ - + 的连续下标</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> length <span class="token operator">=</span> line<span class="token punctuation">.</span>length
    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> char <span class="token operator">=</span> line<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>char <span class="token operator">!==</span> <span class="token string">'^'</span> <span class="token operator">&amp;&amp;</span> char <span class="token operator">!=</span> <span class="token string">'-'</span> <span class="token operator">&amp;&amp;</span> char <span class="token operator">!==</span> <span class="token string">'+'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            i <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">continue</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> length <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>line<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'^'</span> <span class="token operator">||</span> line<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'-'</span> <span class="token operator">||</span> line<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            j <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>
        res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        i <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">parseLine</span><span class="token punctuation">(</span>content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 处理问号行，行内diff级别：字符</span>
    <span class="token keyword">const</span> contentArr <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> totalLines <span class="token operator">=</span> contentArr<span class="token punctuation">.</span>length
    <span class="token keyword">const</span> resArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// console.log(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;parseLine: &quot;, content)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> totalLines<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> line <span class="token operator">=</span> contentArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 问号行必定不会是第一行</span>
            <span class="token keyword">let</span> preLine <span class="token operator">=</span> resArr<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">string</span>
            <span class="token keyword">let</span> indexs <span class="token operator">=</span> <span class="token function">getMarkIndexs</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
            <span class="token keyword">let</span> newLine <span class="token operator">=</span> preLine<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> indexs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> indexs<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> index <span class="token operator">=</span> indexs<span class="token punctuation">[</span>j<span class="token punctuation">]</span>

                <span class="token keyword">let</span> className <span class="token operator">=</span> preLine<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'delete-inline'</span> <span class="token operator">:</span> <span class="token string">'add-inline'</span>
                newLine <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;span class='</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>className<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>preLine<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>index<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;</span><span class="token template-punctuation string">`</span></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> indexs<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">let</span> nextIndex <span class="token operator">=</span> indexs<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
                    newLine <span class="token operator">+=</span> preLine<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>index<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> nextIndex<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    newLine <span class="token operator">+=</span> preLine<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>index<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                j <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token punctuation">}</span>
            resArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newLine<span class="token punctuation">)</span>
            <span class="token comment">// 问号行的下一行是多余的空行</span>
            i<span class="token operator">++</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            resArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> resArr
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">parseLineWithWord</span><span class="token punctuation">(</span>content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 处理问号行，去掉问号行以及多余的空行</span>
    <span class="token keyword">const</span> contentArr <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> totalLines <span class="token operator">=</span> contentArr<span class="token punctuation">.</span>length
    <span class="token keyword">const</span> resArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> totalLines<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> line <span class="token operator">=</span> contentArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 问号行必定不会是第一行</span>
            <span class="token keyword">let</span> preLine <span class="token operator">=</span> resArr<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">string</span>
            resArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>preLine<span class="token punctuation">)</span>
            <span class="token comment">// 问号行的下一行是多余的空行</span>
            i<span class="token operator">++</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            resArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> resArr
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createLine</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token operator">:</span> DiffType<span class="token punctuation">,</span> old<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> now<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// const codeLineModel = {</span>
    <span class="token comment">//     type,</span>
    <span class="token comment">//     oldLineNumber: old,</span>
    <span class="token comment">//     newLineNumber: now,</span>
    <span class="token comment">//     content: content</span>
    <span class="token comment">// }</span>
    <span class="token comment">// if (!lineModels[index]) {</span>
    <span class="token comment">//     lineModels[index] = []</span>
    <span class="token comment">// }</span>
    <span class="token comment">// lineModels[index].push(codeLineModel)</span>
    <span class="token keyword">const</span> codeLineModel <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token keyword">type</span><span class="token punctuation">,</span>
        oldLineNumber<span class="token operator">:</span> old<span class="token punctuation">,</span>
        newLineNumber<span class="token operator">:</span> now<span class="token punctuation">,</span>
        content
    <span class="token punctuation">}</span>
    lineModels<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>codeLineModel<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">parseLineModel</span> <span class="token punctuation">(</span>lineArr<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lineArr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> line <span class="token operator">=</span> lineArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 删除</span>
            currentOldNumber<span class="token operator">++</span>
            <span class="token function">createLine</span><span class="token punctuation">(</span><span class="token string">'delete'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>currentOldNumber <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> line<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 新增</span>
            currentNowNumber<span class="token operator">++</span>
            <span class="token function">createLine</span><span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>currentNowNumber <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> line<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 没有变化</span>
            currentNowNumber<span class="token operator">++</span>
            currentOldNumber<span class="token operator">++</span>
            <span class="token function">createLine</span><span class="token punctuation">(</span><span class="token string">'normal'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>currentOldNumber <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>currentNowNumber <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> line<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">processCollapsed</span><span class="token punctuation">(</span>lineData<span class="token operator">:</span> CodeLineModel<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> lastIsNormal <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">let</span> arrs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> currentArr<span class="token operator">:</span> CodeLineModel<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lineData<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> model <span class="token operator">=</span> lineData<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>model<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">===</span> <span class="token string">'add'</span> <span class="token operator">||</span> model<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">===</span> <span class="token string">'delete'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>lastIsNormal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                arrs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>currentArr<span class="token punctuation">)</span>
                currentArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
            currentArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>
            lastIsNormal <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>model<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">===</span> <span class="token string">'normal'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lastIsNormal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                arrs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>currentArr<span class="token punctuation">)</span>
                currentArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
            currentArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>
            lastIsNormal <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    arrs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>currentArr<span class="token punctuation">)</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">collapsedCodeGroup</span><span class="token punctuation">(</span>arrs<span class="token punctuation">,</span> contextLineCount<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>res<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">collapsedCodeGroup</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> ILineModel<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>arrs<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> context<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> collapseLimit <span class="token operator">=</span> context <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span>
    arrs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>group<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> isNormalGroup <span class="token operator">=</span> group<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> group<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">===</span> <span class="token string">'normal'</span>
        <span class="token keyword">const</span> isLastGroup <span class="token operator">=</span> index <span class="token operator">===</span> arrs<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
        <span class="token keyword">const</span> isFirstGroup <span class="token operator">=</span> index <span class="token operator">===</span> <span class="token number">0</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>group<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> collapseLimit <span class="token operator">||</span> <span class="token operator">!</span>isNormalGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>group<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> collapseLineModel<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'collapsed'</span><span class="token punctuation">,</span>
            lines<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            isCollapsed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            lineCount<span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> lines<span class="token punctuation">,</span> deleteCount
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isFirstGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            deleteCount <span class="token operator">=</span> group<span class="token punctuation">.</span>length <span class="token operator">-</span> context <span class="token operator">*</span> <span class="token number">1</span>
            lines <span class="token operator">=</span> group<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> deleteCount<span class="token punctuation">,</span> collapseLineModel<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>isLastGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            deleteCount <span class="token operator">=</span> group<span class="token punctuation">.</span>length <span class="token operator">-</span> context <span class="token operator">*</span> <span class="token number">1</span>
            lines <span class="token operator">=</span> group<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> deleteCount<span class="token punctuation">,</span> collapseLineModel<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            deleteCount <span class="token operator">=</span> group<span class="token punctuation">.</span>length <span class="token operator">-</span> context <span class="token operator">*</span> <span class="token number">2</span>
            lines <span class="token operator">=</span> group<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> deleteCount<span class="token punctuation">,</span> collapseLineModel<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        collapseLineModel<span class="token punctuation">.</span>lines <span class="token operator">=</span> lines
        collapseLineModel<span class="token punctuation">.</span>lineCount <span class="token operator">=</span> lines<span class="token punctuation">.</span>length
        result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>group<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> result
<span class="token punctuation">}</span>

<span class="token comment">// function diffLine(index: number) {</span>
<span class="token comment">//     if (index &lt;= 0) return</span>
<span class="token comment">//     let addLineData = lineModels[index]</span>
<span class="token comment">//     let delLineData = lineModels[index - 1]</span>
<span class="token comment">//     const minLength = Math.min(addLineData.length, delLineData.length)</span>
<span class="token comment">//     for (let i = 0; i &lt; minLength; i++) {</span>
<span class="token comment">//         let res = diffWordsWithSpace(delLineData[i].content, addLineData[i].content)</span>
<span class="token comment">//         let addIndexs: number[] = [], addLengths: number[] = []</span>
<span class="token comment">//         let delIndexs: number[] = [], delLengths: number[] = []</span>
<span class="token comment">//         let addNumber = 0</span>
<span class="token comment">//         let delNumber = 0</span>
<span class="token comment">//         res.forEach(item =&gt; {</span>
<span class="token comment">//             if (item.added) {</span>
<span class="token comment">//                 addIndexs.push(addNumber)</span>
<span class="token comment">//                 addLengths.push(item.value.length)</span>
<span class="token comment">//                 addNumber += item.value.length</span>
<span class="token comment">//             } else if (item.removed) {</span>
<span class="token comment">//                 delIndexs.push(delNumber)</span>
<span class="token comment">//                 delLengths.push(item.value.length)</span>
<span class="token comment">//                 delNumber += item.value.length</span>
<span class="token comment">//             } else {</span>
<span class="token comment">//                 addNumber += item.value.length</span>
<span class="token comment">//                 delNumber += item.value.length</span>
<span class="token comment">//             }</span>
            
<span class="token comment">//         })</span>
<span class="token comment">//         addLineData[i].highlightStartIndex = addIndexs</span>
<span class="token comment">//         addLineData[i].hightLightLength = addLengths</span>
<span class="token comment">//         delLineData[i].highlightStartIndex = delIndexs</span>
<span class="token comment">//         delLineData[i].hightLightLength = delLengths</span>
<span class="token comment">//     }</span>
    
<span class="token comment">// }</span>
</code></pre></div><h2 id="axios简单封装"><a href="#axios简单封装" class="header-anchor">#</a> axios简单封装</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token keyword">let</span> baseConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    baseURL<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    timeout<span class="token operator">:</span> <span class="token number">5000</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Request</span> <span class="token punctuation">{</span>
    instance <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>baseConfig<span class="token punctuation">,</span> <span class="token operator">...</span>config <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> token <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                config<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>Authorization <span class="token operator">=</span> <span class="token string">'Bearer '</span> <span class="token operator">+</span> token
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> config
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'/login'</span>
                    <span class="token keyword">return</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> response<span class="token punctuation">.</span>data
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> response
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">request</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;reqeust err: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">get</span> <span class="token punctuation">(</span>url<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        options <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            url<span class="token punctuation">,</span>
            method<span class="token operator">:</span> <span class="token string">'get'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;request options: '</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">post</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            url<span class="token punctuation">,</span>
            method<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> options
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">delete</span> <span class="token punctuation">(</span>url<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        options <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            url<span class="token punctuation">,</span>
            method<span class="token operator">:</span> <span class="token string">'delete'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Request

</code></pre></div><h2 id="其他内容"><a href="#其他内容" class="header-anchor">#</a> 其他内容</h2> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>diff确认页面用到的都是比较基本的vue知识，难度不高，基本上照着elementui文档写就可以了，没踩什么坑，主要是注意分页后更新某条数据时根据后端返回的最新数据更新局部数据就好了，不需要再重新全部拉取，不过这样如果别人同时在确认其他diff，但是还有不少可以优化的地方：比如diff组件中用了3个diff-content子组件以及3个控制是否显示的变量，说明是不是diff-content组件封装的还不够好。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuepress-blog/测试工程师/通用测试用例.html" class="prev">
        通用测试用例
      </a></span> <span class="next"><a href="/vuepress-blog/综合实践/diff确认平台-nodejs/koa-diff服务器搭建.html">
        koa-diff服务器搭建
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress-blog/assets/js/app.de1052c8.js" defer></script><script src="/vuepress-blog/assets/js/2.b6e7c728.js" defer></script><script src="/vuepress-blog/assets/js/34.bb466845.js" defer></script>
  </body>
</html>
